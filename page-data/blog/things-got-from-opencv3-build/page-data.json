{"componentChunkName":"component---src-templates-page-js","path":"/blog/things-got-from-opencv3-build","webpackCompilationHash":"9b3f9fa43259e3029494","result":{"data":{"markdownRemark":{"frontmatter":{"title":"从编译OpenCV3 学到的东西","date":"Wed, 16th October 2019","tags":["OpenCV","CMake","OpenGL"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAEAElEQVQ4y5WUbUxbVRjHb9tkc4kfNMbsix+XLNEYg1+mvM3xMqOwDGh52fo2qLpoZpiZHxRdXLYIbDAGjAEuBmM2Mh0ZA8ckY47YFqWQWVBhZW15q0BR15aBQtvbe/4+5/YF5ksyT/LkOffJPb/zf/7nnisIDzlSqq1CSpVFnidXW1WxvDW52jKTXGXtoRAeetBCOeR5lVUZy5upZnvp3Dgoz9Hzo/8LGMuKRK3K2rWzYZTDwhQZ0ZpF+a8AuHWJvHLHJGA+X7jcW614oXJAEW3f0pxeP4LUU4MgsPxySlXUhg0QvQyAax3GXHoVZeWDXlreT6+7jTQKPo/5q/qHhxzIB6PM3LoHdjvW3rYJEFSp1ZYDabU27GocRfpJc2vc07ST5rgNf4O5uCqd3JY0odsCp1YdmjB+Bk+hc8DygefFSmso+cwonj0+3C6vW0tX1na0yh0Mffce72jds/BgocCcURjlUmrdg0UTcF8P71g5cs6asf24nb3d8iXWxo3X4dU8E+9AcumVG4XF1clFNqFNxWIZMF8KDKtF13WTmFnTLyV99L30YW0Tu3elQILXgIjLwGjTjwmmisHWbZIcWgFzRlkdZo09cOmxfPGVUOD8btb+yVFcuFTJ7vYdZLCrGSa1kNwGkboCfjeBPP+B5tsSUPlkpwxRyfdfezo8VCT+0ZGLkFnNIg4dw5QWmNEAs/vBpgyMFHFlHMSoqzC81Ilb56eDfD6hMHirQJYbNKvLMVgM8lBkM0awSb5ID9FpgOTUg3HQOoyRIg4LY/4Ar89RPCms/aQTQvb9UeBQSSMWTJCmjSKmSxjuloADMW1IwDhEzlypWx+D6kO8fcqHBL/zTQG+jJh/+75BgFocyxPtl15nrs/3seDVV1looBCYjAJiYBaDx2sRLJSCDrRCgGNnFLbw2OMj5sOzfTdPoKbptPROfRt8N4rYalcOAm0vS6u9eSJBw6Q2IgOdOm6NnKku4tcy7vsh4YvOE3K7s5ayd02f3sDWijtBzelrbGlIi8itXKx8ncckexFwbS9FHm9VtgAeY5i+iAhmDXwjKWLWwH82K0l46uiYfMIlDd19OxoceKvlKrzdxYA9P7zUsSci2jRYuZI77z+X9YbvTMaRpfO7LfQVMHxLJ08Q9BUA3XnwN2Y2J06Z7mXujroxaBp7fvF8pb0I295l/KzFai+pcmgRaM46tfFu/3YsLeleza4K2qDTV5fR46vPKI+MlCjif49HKOYouvo7j2zmtaXbusw/e/aYgjbN+Gp//jQteo7XAy3Zm7BY+p//TX9TlvyH2E5xMF483HohcYXCPxY/ERou3MLny5dzZAWB5myB2ldSVgVasxWUFfSs4nU+/gIy9Otdiq3k4gAAAABJRU5ErkJggg==","width":150,"height":150,"src":"/static/aba3e73970a3fc923209ab21b7738b2a/4148e/writing.png","srcSet":"/static/aba3e73970a3fc923209ab21b7738b2a/4148e/writing.png 1x,\n/static/aba3e73970a3fc923209ab21b7738b2a/de03e/writing.png 1.5x,\n/static/aba3e73970a3fc923209ab21b7738b2a/1e9e2/writing.png 2x"}}}},"html":"<p>哦哦，冷冽的风，谁在唱着离歌，黑夜沉沉。\nThis line is added by KeyTo9_Fans.</p>\n<p>之前主要是懒，一直都在用<a href=\"http://opencv.org/\">OpenCV</a> 2.4.9，是安装Kurento media server的时候被动的安装上的。今天尝试源码编译安装了<a href=\"http://opencv.org/\">OpenCV</a>3.3,想体验一把新功能。</p>\n<!-- more --> \n<h1>附加模块包</h1>\n<p><a href=\"https://github.com/opencv/opencv_contrib\">OpenCV contrib</a>这个必须要有的。官网提供了<a href=\"http://docs.opencv.org/master/d3/d81/tutorial_contrib_root.html\">教程</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">aruco        contrib_world       dpm       img_hash          plot       sfm               tracking\nbgsegm       cvv                 face      line_descriptor   README.md  stereo            xfeatures2d\nbioinspired  datasets            freetype  matlab            reg        structured_light  ximgproc\nccalib       dnn_modern          fuzzy     optflow           rgbd       surface_matching  xobjdetect\ncnn_3dobj    dnns_easily_fooled  hdf       phase_unwrapping  saliency   text              xphoto</code></pre></div>\n<h1>视频IO</h1>\n<p>OpenCV的官方文档讲到了关于OpenCV的视频处理背后的支撑框架\n<a href=\"http://docs.opencv.org/trunk/d0/da7/videoio_overview.html\">Video I/O with OpenCV Overview</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">CAP_ANY \t\nAuto detect == 0.\nCAP_VFW \t\nVideo For Windows (platform native)\nCAP_V4L \t\nV4L/V4L2 capturing support via libv4l.\nCAP_V4L2 \t\nSame as CAP_V4L.\nCAP_FIREWIRE \t\nIEEE 1394 drivers.\nCAP_FIREWARE \t\nSame as CAP_FIREWIRE.\nCAP_IEEE1394 \t\nSame as CAP_FIREWIRE.\nCAP_DC1394 \t\nSame as CAP_FIREWIRE.\nCAP_CMU1394 \t\nSame as CAP_FIREWIRE.\nCAP_QT \t\nQuickTime.\nCAP_UNICAP \t\nUnicap drivers.\nCAP_DSHOW \t\nDirectShow (via videoInput)\nCAP_PVAPI \t\nPvAPI, Prosilica GigE SDK.\nCAP_OPENNI \t\nOpenNI (for Kinect)\nCAP_OPENNI_ASUS \t\nOpenNI (for Asus Xtion)\nCAP_ANDROID \t\nAndroid - not used.\nCAP_XIAPI \t\nXIMEA Camera API.\nCAP_AVFOUNDATION \t\nAVFoundation framework for iOS (OS X Lion will have the same API)\nCAP_GIGANETIX \t\nSmartek Giganetix GigEVisionSDK.\nCAP_MSMF \t\nMicrosoft Media Foundation (via videoInput)\nCAP_WINRT \t\nMicrosoft Windows Runtime using Media Foundation.\nCAP_INTELPERC \t\nIntel Perceptual Computing SDK.\nCAP_OPENNI2 \t\nOpenNI2 (for Kinect)\nCAP_OPENNI2_ASUS \t\nOpenNI2 (for Asus Xtion and Occipital Structure sensors)\nCAP_GPHOTO2 \t\ngPhoto2 connection\nCAP_GSTREAMER \t\nGStreamer.\nCAP_FFMPEG \t\nOpen and record video file or stream using the FFMPEG library.\nCAP_IMAGES \t\nOpenCV Image Sequence (e.g. img_%02d.jpg)\nCAP_ARAVIS \t\nAravis SDK.\nCAP_OPENCV_MJPEG \t\nBuilt-in OpenCV MotionJPEG codec.\nCAP_INTEL_MFX \t\nIntel MediaSDK.</code></pre></div>\n<p>WITH<em>FFMPEG默认是OFF的，要想开启<a href=\"http://ffmpeg.org/\">FFMPEG</a>的支持，还需要确保<a href=\"http://ffmpeg.org/\">FFMPEG</a>是动态库版本, <strong>--enable-shared --disable-static</strong>, 我更喜欢 <a href=\"https://gstreamer.freedesktop.org/\">GStreamer</a>,WITH</em>GSTREAMER 默认就是ON的</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">--   Video I/O:\n--     DC1394 1.x:                  NO\n--     DC1394 2.x:                  YES (ver 2.2.4)\n--     FFMPEG:                      YES\n--       avcodec:                   YES (ver 57.105.100)\n--       avformat:                  YES (ver 57.82.100)\n--       avutil:                    YES (ver 55.74.100)\n--       swscale:                   YES (ver 4.7.103)\n--       avresample:                YES (ver 2.1.0)\n--     GStreamer:                   NO\n--     OpenNI:                      NO\n--     OpenNI PrimeSensor Modules:  NO\n--     OpenNI2:                     NO\n--     PvAPI:                       NO\n--     GigEVisionSDK:               NO\n--     Aravis SDK:                  NO\n--     UniCap:                      NO\n--     UniCap ucil:                 NO\n--     V4L/V4L2:                    Using libv4l1 (ver 1.10.0) / libv4l2 (ver 1.10.0)\n--     XIMEA:                       NO\n--     Xine:                        NO\n--     Intel Media SDK:             NO\n--     gPhoto2:                     YES</code></pre></div>\n<h1>矩阵运算</h1>\n<p><a href=\"http://eigen.tuxfamily.org/index.php\">Eigen</a>, <a href=\"http://www.netlib.org/lapack\">LAPACK</a>,<a href=\"http://math-atlas.sourceforge.net/\">ATLAS</a></p>\n<h1>OpenGL支持</h1>\n<p>编译<a href=\"http://opencv.org/\">OpenCV</a> 会有一个WITH_OPENGL。这个应该是给highgui界面提供OpenGL硬件渲染用的，默认不开启，即hightgui默认都是cpu渲染。所以要想开启该选项，先要选好一个GUI类型。要么是GTK2要么是Qt.编译的时候</p>\n<h2>开启Qt支持</h2>\n<p>所以要 <strong>-DWITH<em>QT=ON -DWITH</em>OPENGL=ON</strong>,先安装好<a href=\"http://download.qt.io/archive/qt/\">Qt</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">--   GUI: \n--     QT 5.x:                      YES (ver 5.9.1)\n--     QT OpenGL support:           YES (Qt5::OpenGL 5.9.1)\n--     OpenGL support:              YES (/usr/lib/x86_64-linux-gnu/libGLU.so /usr/lib/x86_64-linux-gnu/libGL.so)\n--     VTK support:                 NO</code></pre></div>\n<h2>开启gtk支持</h2>\n<p><a href=\"https://www.bassi.io/articles/2015/02/17/using-opengl-with-gtk/\">Using OpenGL with GTK+</a>这篇文章提及了。Gtk+的OpenGL支持有两种方案，一种是<a href=\"https://developer.gnome.org/gtk3/unstable/GtkGLArea.html\">GtkGLArea</a>，一种是<a href=\"https://projects.gnome.org/gtkglext/\">GtkGlExt</a>。而<a href=\"https://projects.gnome.org/gtkglext/\">GtkGlExt</a>代码比较legacy，官方还不支持Gtk+3。不幸的是,<a href=\"http://opencv.org/\">OpenCV</a>用的是<a href=\"https://projects.gnome.org/gtkglext/\">GtkGlExt</a>，而非<a href=\"https://developer.gnome.org/gtk3/unstable/GtkGLArea.html\">GtkGLArea</a>，所以要么Gtk3+no OpenGL,要么Gtk2+OpenGL。<strong>-DWITH<em>OPENGL=ON -DWITH</em>GTK<em>2</em>X=ON</strong>\nUbuntu下，就是安装依赖包 libgtkglext1 libgtkglext1-dev</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">--   GUI: \n--     QT:                          NO\n--     GTK+ 2.x:                    YES (ver 2.24.30)\n--     GThread :                    YES (ver 2.48.2)\n--     GtkGlExt:                    YES (ver 1.2.0)\n--     OpenGL support:              YES (/usr/lib/x86_64-linux-gnu/libGLU.so /usr/lib/x86_64-linux-gnu/libGL.so)\n--     VTK support:                 NO</code></pre></div>\n<h1>GPU/CUDA 加速</h1>\n<p>目前是通过<a href=\"https://developer.nvidia.com/cuda-downloads\">CUDA</a>模块来支持的。所以要有NVIDIA显卡了。\n先安装好NVIDIA驱动以及<a href=\"https://developer.nvidia.com/cuda-downloads\">CUDA</a>，测试可用再运行cmake，将自动检测到支持<br>\n留意到<a href=\"https://developer.nvidia.com/cuda-downloads\">CUDA</a>有一个子特性NVCUVID的支持是NO</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">--   NVIDIA CUDA\n--     Use CUFFT:                   YES\n--     Use CUBLAS:                  YES\n--     USE NVCUVID:                 NO\n--     NVIDIA GPU arch:             20 30 35 37 50 52 60 61\n--     NVIDIA PTX archs:\n--     Use fast math:               NO</code></pre></div>\n<p>根据官网<a href=\"https://developer.nvidia.com/nvidia-video-codec-sdk\">NVIDIA VIDEO CODEC SDK</a>得知，NVCUVID API已经是legacy的了，所以我就大可放心了。</p>\n<h1>OCR支持</h1>\n<p><a href=\"https://github.com/tesseract-ocr/tesseract/wiki\">Tesseract</a> 安装好后，将自动检测到</p>\n<h1>图像库</h1>\n<p><a href=\"http://www.leptonica.com/local-sources.html\">lept</a>，<br>\n<a href=\"https://support.hdfgroup.org/HDF5/\">HDF5</a>，<br>\n<a href=\"http://www.ece.uvic.ca/~frodo/jasper/\">libjasper</a> JPEG-2000 图像格式</p>\n<h1>Halide</h1>\n<p><a href=\"http://halide-lang.org/\">Halide</a> 这个比较有意思，头一次听说，有空再补充</p>\n<h1>intel VA-API视频加速</h1>\n<p><a href=\"https://freedesktop.org/wiki/Software/vaapi/\">VA-API</a>是开源的,另一个地址<a href=\"https://01.org/linuxmedia/vaapi\">VAAPI</a>, cmake编译通过 WITH<em>VA</em>INTEL=ON，ubuntu下，安装 libvdpau-va-gl1</p>\n<h1>intel多媒体加速</h1>\n<p><a href=\"https://github.com/Intel-Media-SDK/MediaSDK\">Intel Media SDK</a> 是针对intel平台的音视频硬件加速的SDK，需要先安装好<a href=\"https://software.intel.com/en-us/intel-media-server-studio\">Intel Media Server Studio</a>,而该包有community版本，但安装过程貌似需要重新编译kernel。见<a href=\"https://software.intel.com/en-us/articles/how-to-setup-media-server-studio-on-secondary-os-of-linux\">Linux下的安装教程</a>.考虑到这个会严重到NVIDIA显卡驱动的可用性，本人并未着手安装。</p>\n<h1>intel并行计算库</h1>\n<p>intel开源的<a href=\"https://software.intel.com/en-us/articles/intel-integrated-performance-primitives-intel-ipp-open-source-computer-vision-library-opencv-faq\">IPP-ICV</a>是intel <a href=\"https://software.intel.com/en-us/intel-ipp\">IPP</a>的图像处理和机器视觉开发包的子集。同上，有专门针对intel架构的优化指令集。</p>\n<h1>行业数据库</h1>\n<p><a href=\"http://www.gdal.org/\">GDAL</a> 地理抽象数据库。<br>\n<a href=\"https://www.vtk.org/\">VTK</a>, <a href=\"https://itk.org/\">ITK</a> 医学图像库</p>\n<h1>结语</h1>\n<p>附带我的<a href=\"http://opencv.org/\">OpenCV</a>编译选项：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cmake ../opencv -DWITH_HALIDE=ON -DWITH_FFMPEG=OFF  -DWITH_GSTREAMER=ON -DWITH_QT=ON -DWITH_OPENGL=ON -DWITH_VA_INTEL=ON -DWITH_LIBV4L=ON -DWITH_LIBV4L=ON -DWITH_GDAL=ON -DWITH_GDCM=ON -DOPENCV_EXTRA_MODULES_PATH=../opencv_contrib/modules</code></pre></div>\n<p><a href=\"http://ffmpeg.org/\">FFMPEG</a>编译选项</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PATH=&quot;$HOME/bin:$PATH&quot; PKG_CONFIG_PATH=&quot;$HOME/ffmpeg_build/lib/pkgconfig&quot; ./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --enable-shared --disable-static  --extra-cflags=&quot;-I$HOME/ffmpeg_build/include -I/usr/local/cuda/include&quot;   --extra-ldflags=&quot;-L$HOME/ffmpeg_build/lib -L/usr/local/cuda/lib64&quot;   --bindir=&quot;$HOME/bin&quot;   --enable-gpl   --enable-libass   --enable-libfdk-aac   --enable-libfreetype   --enable-libmp3lame   --enable-libopus   --enable-libtheora   --enable-libvorbis   --enable-libvpx   --enable-libx264   --enable-libx265 --enable-nonfree --enable-cuda --enable-cuvid --enable-nvenc --enable-nonfree --enable-libnpp --enable-libpulse  --enable-libspeex --enable-avisynth  --enable-network --enable-protocol=tcp --enable-demuxer=rtsp</code></pre></div>","fields":{"slug":"things-got-from-opencv3-build"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"things-got-from-opencv3-build"}}}